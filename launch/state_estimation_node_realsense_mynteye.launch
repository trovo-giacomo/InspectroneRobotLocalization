<launch>
    <arg name="record_bag" default="true" />
    <arg name="input_bag_name" default="rovio_mynteye_abs_odom_imu.bag" />
    <arg name="output_bag_name" default="rovio_mynteye_fused.bag" />
    <param name="use_sim_time" value="true" />

    <node name="ekf_odom" pkg="robot_localization" type="ekf_localization_node" clear_params="true">
        <param name="map_frame" value="map" />
        <param name="odom_frame" value="odom" />
        <param name="base_link_frame" value="base_link" />
        <param name="world_frame" value="odom" />

        <param name="odom0" value="camera/odom/sample" />
        <param name="odom1" value="rovio/odometry" />
        <param name="imu0"  value="mavros/imu/data" />

        <!-- X,Y,Z,roll,pitch,yaw,X˙,Y˙,Z˙,roll˙,pitch˙,yaw˙,X¨,Y¨,Z¨)-->
        <rosparam param="odom0_config">[true, true, true,
                                        true, true, true,
                                        true, true, true,
                                        true, true, true,
                                        false, false, false]</rosparam>

        <rosparam param="odom1_config">[false, false, false,
                                        true, true, true,
                                        true, true, true,
                                        true, true, true,
                                        false, false, false]</rosparam>
        <rosparam param="imu0_config">[false, false, false,
                                        true, true, true,
                                        false, false, false,
                                        true, true, true,
                                        true, true, true]</rosparam>                                        

        <param name="odom0_differential" value="false" />
        <param name="odom1_differential" value="true" />
        <param name="imu0_differential" value="true" />

        <param name="imu0_remove_gravitational_acceleration"  value="true"/>

        <param name="odom0_relative" value="false" />
        <param name="odom1_relative" value="false" />
        <param name="imu0_relative" value="false" />

        <param name="odom0_queue_size" value="10" />
        <param name="odom1_queue_size" value="10" />
        <param name="imu0_queue_size" value="10" />

    </node>

    <!-- Play bag -->
    <node pkg="rosbag" type="play" name="player" output="screen" args="/home/giacomo/inspectrone_ws/bags/inspectrone/rovio/$(arg input_bag_name) --clock"/>

    <!-- Recrod new bag -->
    <node pkg="rosbag" type="record" name="rosbag_simulation"
        args="record -O /home/giacomo/inspectrone_ws/bags/inspectrone/filtered/$(arg output_bag_name) --all"
        if="$(arg record_bag)" />
</launch>